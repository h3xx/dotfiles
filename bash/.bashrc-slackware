# .bashrc-slackware

# Slackware Linux specific definitions

HISTIGNORE+=':startx:chkpkg *:checkver*'

## package-related

# building
alias \
	ch='./configure --help' \
	dbuild='dconf && make && midest' \
	ddbuild='ddconf && make && midest' \
	ddebuild='ddeconf && make && midest' \
	midest='make install DESTDIR="$PWD/b"'

# querying

# Find amongst installed package names
# chkpkg PACKAGE
# Usefulness: *****
chkpkg() {
	local ERR
	cpk() {
		local REGEX="($(IFS='|'; echo "$*"))"
		find /var/log/packages/ \
			-maxdepth 1 \
			-regextype 'posix-egrep' \
			-printf '%f\n' |
		grep -Ei -- "$REGEX"
	}
	if [[ $# -gt 0 ]]; then
		cpk "$@"
		ERR=$?
	else
		# read in package patterns one line at a time
		# Usefulness: ?
		local LINE
		while read LINE; do
			# (sic) split on whitespace
			cpk $LINE
			ERR=$?
		done
	fi
	unset cpk
	return $ERR
}

catpkg() {
	local PKG
	for PKG in $(chkpkg "$@") ; do
		if [[ -f /var/log/scripts/$PKG ]]; then
			cat "/var/log/scripts/$PKG"
		fi
		cat "/var/log/packages/$PKG"
	done
}

watpkg() {
	catpkg "$@" |grep :
}

pkglook() {
	local \
		PKG_FILE \
		SLACK_META \
		INSTALL_LIST

	for PKG_FILE; do
		if [[ -f $PKG_FILE ]]; then
			if tar tf "$PKG_FILE" 'install' >/dev/null 2>&1; then
				mapfile -t INSTALL_LIST < <(
					tar tf "$PKG_FILE" 'install' |
					grep -v '/$'
				)
				for SLACK_META in "${INSTALL_LIST[@]}"; do
					echo "==== $SLACK_META ===="
					tar xOf "$PKG_FILE" "$SLACK_META"
				done
			fi

			tar tvvf "$PKG_FILE"
		fi
	done |less
}
