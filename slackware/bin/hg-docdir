#!/bin/bash
# vi: et sts=4 sw=4 ts=4

DOCDIR_BASE='usr/doc'

# ensure non-translated messages
export LC_MESSAGES=C

hg_rev() {
    local \
        DIR=${1:-$PWD}

    if [[ -d $DIR/.hg ]]; then
        if hash hg &>/dev/null; then
            (cd "$DIR" && hg tip) |
            grep -oP '^changeset:\s*\d+:' |
            grep -oP '\d+'
        fi
    fi
}

REV=$(hg_rev "${1:-$PWD}")
if [[ -n $REV && $((REV+0)) -gt 0 ]]; then
    echo "$DOCDIR_BASE/$(basename -- "${1:-$PWD}")-r$REV"
else
    exec "$(dirname -- "$(readlink -f -- "$0")")/cvs-docdir" "$@"
fi
